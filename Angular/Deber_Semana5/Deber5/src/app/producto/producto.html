<h1 class="titulo">Lista de Productos</h1>

<div class="topbar">
  <input
    class="search"
    type="text"
    placeholder="Buscar por nombre, categoría, precio o stock..."
    [(ngModel)]="filtro"
    (input)="aplicarFiltro()"
  />

  <button class="btn-primary" type="button" (click)="irNuevo()">Nuevo Producto</button>
  <button class="btn-factura" type="button" (click)="generarFactura()">Generar Factura</button>
  <button class="btn-light" type="button" (click)="limpiarFiltro()">Limpiar</button>
</div>

<div class="cliente-card">
  <div class="cliente-grid">
    <div>
      <label>Cliente</label>
      <input type="text" [(ngModel)]="clienteNombre" (blur)="guardarClienteEnStorage()" placeholder="Ej: Henry Alvarez">
    </div>

    <div>
      <label>Cédula / RUC</label>
      <input type="text" [(ngModel)]="clienteCedula" (blur)="guardarClienteEnStorage()" placeholder="Ej: 1723456789">
    </div>

    <div>
      <label>Dirección</label>
      <input type="text" [(ngModel)]="clienteDireccion" (blur)="guardarClienteEnStorage()" placeholder="Ej: San Lorenzo">
    </div>

    <div>
      <label>Teléfono</label>
      <input type="text" [(ngModel)]="clienteTelefono" (blur)="guardarClienteEnStorage()" placeholder="Ej: 098xxxxxxx">
    </div>
  </div>
</div>

<div class="card">
  <table class="tabla">
    <thead>
      <tr>
        <th style="width:50px; text-align:center;">
          <input type="checkbox" (change)="seleccionarTodos($any($event.target).checked)" />
        </th>
        <th>#</th>
        <th>Nombre</th>
        <th>Precio</th>
        <th>Stock</th>
        <th>Categoría</th>
        <th style="width:120px; text-align:center;">Cant.</th>
        <th class="acciones-col">Acciones</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let p of productosFiltrados; let i = index">
        <td style="text-align:center;">
          <input
            type="checkbox"
            [checked]="seleccion[p.id] != null"
            (change)="toggleSeleccion(p.id, $any($event.target).checked)"
          />
        </td>

        <td>{{ i + 1 }}</td>
        <td>{{ p.nombre }}</td>
        <td>{{ p.precio }}</td>
        <td>{{ p.stock }}</td>
        <td>{{ p.categoria }}</td>

        <td style="text-align:center;">
          <input
            class="qty"
            type="number"
            min="1"
            [disabled]="seleccion[p.id] == null"
            [ngModel]="seleccion[p.id] ?? 1"
            (ngModelChange)="setCantidad(p.id, $event)"
          />
        </td>

        <td class="acciones">
          <button class="btn-edit" type="button" (click)="irEditar(p.id)">Editar</button>
          <button class="btn-del" type="button" (click)="eliminarProducto(p.id)">Eliminar</button>
        </td>
      </tr>

      <tr *ngIf="productosFiltrados.length === 0">
        <td colspan="8" class="vacio">No hay productos para mostrar</td>
      </tr>
    </tbody>
  </table>
</div>